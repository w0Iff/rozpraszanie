#BUILD APP
FROM maven:3-eclipse-temurin-17-alpine AS mvn
WORKDIR /app
COPY pom.xml .
COPY src ./src

ARG PORT
ARG CASSANDRA_KEYSPACE_NAME
ARG CASSANDRA_USERNAME
ARG CASSANDRA_PASSWORD
ARG CASSANDRA_PORT
ARG CASSANDRA_CONTACT_POINT
ARG CASSANDRA_LOCAL_DATACENTER
ARG API_CLEANER_URL

ENV PORT=$PORT
ENV CASSANDRA_KEYSPACE_NAME=$CASSANDRA_KEYSPACE_NAME
ENV CASSANDRA_USERNAME=$CASSANDRA_USERNAME
ENV CASSANDRA_PASSWORD=$CASSANDRA_PASSWORD
ENV CASSANDRA_PORT=$CASSANDRA_PORT
ENV CASSANDRA_CONTACT_POINT=$CASSANDRA_CONTACT_POINT
ENV CASSANDRA_LOCAL_DATACENTER=$CASSANDRA_LOCAL_DATACENTER
ENV API_CLEANER_URL=$API_CLEANER_URL

RUN mvn -e -B package -P prod -DskipTests

FROM eclipse-temurin:17-alpine
WORKDIR /app

COPY src/main/resources /app/resources

COPY --from=mvn /app/target/redirect_microservice-0.0.1-SNAPSHOT.jar .
EXPOSE $PORT
CMD ["java", "-jar", "redirect_microservice-0.0.1-SNAPSHOT.jar"]